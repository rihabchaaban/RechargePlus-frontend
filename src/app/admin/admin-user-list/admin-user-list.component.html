<div class="container">
  <h2>ğŸ‘¥ Liste des utilisateurs</h2>
  <input type="text" [(ngModel)]="searchTerm" placeholder="ğŸ” Rechercher..." (input)="onSearch()" />


  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Nom</th>
        <th>Email</th>
        <th>RÃ´le</th>
        <th>Statut</th> <!-- âœ… Nouvelle colonne -->
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users">
        <td>{{ user.idUser }}</td>
        <td>{{ user.name }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.role }}</td>

        <!-- âœ… Pastille de statut -->
        <td>
          <span [ngClass]="user.enabled ? 'badge-active' : 'badge-blocked'">
            {{ user.enabled ? 'Actif' : 'BloquÃ©' }}
          </span>
        </td>

        <td>
          <button (click)="deleteUser(user.idUser)">ğŸ—‘ Supprimer</button>
          <button (click)="editUser(user)">âœï¸ Modifier</button>
          <button (click)="toggleStatus(user.idUser)">
            {{ user.enabled ? 'ğŸ”’ Bloquer' : 'ğŸ”“ DÃ©bloquer' }}
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ğŸ” Formulaire d'ajout -->
<button (click)="toggleForm()" class="add-btn">â• Ajouter un utilisateur</button>

<<div *ngIf="showForm && !userToEdit" class="user-form">
  <h3>CrÃ©er un utilisateur</h3>
  
  <!-- Nom -->
  <input [(ngModel)]="newUser.name" 
         #name="ngModel"
         name="name" 
         placeholder="Nom complet" 
         required 
         minlength="3" />
  <small *ngIf="name.invalid && name.touched" style="color: red">
    * Le nom doit avoir au moins 3 caractÃ¨res
  </small>

  <!-- Email -->
  <input [(ngModel)]="newUser.email" 
         #email="ngModel"
         name="email" 
         placeholder="Email" 
         required 
         email />
  <small *ngIf="email.invalid && email.touched" style="color: red">
    * Entrez un email valide
  </small>

  <!-- Mot de passe -->
  <input [(ngModel)]="newUser.password" 
         #password="ngModel"
         name="password" 
         type="password" 
         placeholder="Mot de passe" 
         required 
         minlength="6" />
  <small *ngIf="password.invalid && password.touched" style="color: red">
    * 6 caractÃ¨res minimum
  </small>

  <!-- RÃ´le -->
  <select [(ngModel)]="newUser.role" 
          #role="ngModel"
          name="role" 
          required>
    <option value="">-- SÃ©lectionnez un rÃ´le --</option>
    <option value="ADMIN">Admin</option>
    <option value="CLIENT">Client</option>
  </select>
  <small *ngIf="role.invalid && role.touched" style="color: red">
    * SÃ©lection obligatoire
  </small>

  <button (click)="addUser()" 
          [disabled]="name.invalid || email.invalid || password.invalid || role.invalid">
    Valider
  </button>
</div>

<!-- âœï¸ Formulaire de modification -->
<div *ngIf="userToEdit" class="user-form">
  <h3>Modifier l'utilisateur</h3>
  
  <!-- Nom -->
  <input [(ngModel)]="userToEdit.name" 
         #editName="ngModel"
         name="editName" 
         placeholder="Nom complet" 
         required 
         minlength="3" />
  <small *ngIf="editName.invalid && editName.touched" style="color: red">
    * Le nom doit avoir au moins 3 caractÃ¨res
  </small>

  <!-- Email -->
  <input [(ngModel)]="userToEdit.email" 
         #editEmail="ngModel"
         name="editEmail" 
         placeholder="Email" 
         required 
         email />
  <small *ngIf="editEmail.invalid && editEmail.touched" style="color: red">
    * Entrez un email valide
  </small>

  <!-- Mot de passe (optionnel) -->
  <input [(ngModel)]="userToEdit.password" 
         name="editPassword" 
         type="password" 
         placeholder="Nouveau mot de passe (laisser vide si inchangÃ©)" />

  <!-- RÃ´le -->
  <select [(ngModel)]="userToEdit.role" 
          #editRole="ngModel"
          name="editRole" 
          required>
    <option value="ADMIN">Admin</option>
    <option value="CLIENT">Client</option>
  </select>
  <small *ngIf="editRole.invalid && editRole.touched" style="color: red">
    * SÃ©lection obligatoire
  </small>

  <button (click)="updateUser()" 
          [disabled]="editName.invalid || editEmail.invalid || editRole.invalid">
    Mettre Ã  jour
  </button>
  <button (click)="cancelEdit()">Annuler</button>
</div>